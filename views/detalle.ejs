<%- include("template/cabecera",{tituloweb:"Detalle nueva Mascota"}) %>

<body>
    <div class="container">
        <h1>Detalle</h1>
        <% if (error) { %>
            <p>
                <%= mensaje %>
            </p>
            <a href="/mascotas" class="btn btn-dark btn-block">Volver a Mascotas</a>
        <% } %>

        <% if (!error) { %>
            <form id="formularioEdit" data-id="<%= mascota.id %>">
                <input type="text"
                class="form-control my-2"
                name="nombre"
                value="<%= mascota.nombre %>"
                id="nombreInput"
                >
                <form id="formularioEdit">
                    <input type="text"
                    class="form-control my-2"
                    name="descripcion"
                    value="<%= mascota.descripcion %>"
                    id="descripcionInput"
                    >
                    <button
                    class="btn btn-warning btn-block"
                    type="submit"
                    >
                        Editar
                    </button>
            </form>
            <button
            class="btn btn-danger btn-sm mt-5"
            id="btnEliminar"
            data-id="<%= mascota.id %>"
            >
                Eliminar
            </button>

            <!-- <table class="table">
                <thead>
                  <tr>
                    <th scope="col">id</th>
                    <th scope="col">nombre</th>
                    <th scope="col">descripcion</th>
                    <th scope="col">accion</th>
                  </tr>
            </thead>
            <tbody>
                 <tr>
                    <th scope="row"><%= mascota.id %> </th>
                    <td><%= mascota.nombre %></td>
                    <td><%= mascota.descripcion %></td>
                    <td>
                        <button
                            class="btn btn-danger btn-sm"
                            id="btnEliminar"
                            data-id="<%= mascota.id %>"
                            >    Eliminar
                        </button>
                    </td>
                    </tr>
                </tbody>
              </table> -->
        <% } %>


    </div>
    <%- include("template/footer") %>

<script>
    const btnEliminar = document.querySelector('#btnEliminar')
    btnEliminar.addEventListener('click',async() => {
        console.log('diste click')
        const id = btnEliminar.dataset.id
        console.log('id',id)
        try {

            const data = await fetch(`/mascotas/${id}`, {
                method: 'delete'
            })
            const res=await data.json()
            if(res.estado){
                window.location.href='/mascotas'
            }else{
                console.log(res)
            }
            console.log(res)
        } catch (error) {
            console.log(error)

        }
    })
    const formularioEdit = document.querySelector('#formularioEdit')
    formularioEdit.addEventListener('submit',async(e) =>{
        e.preventDefault()
        const nombre=formularioEdit.elements['nombre'].value
        const descripcion=formularioEdit.elements['descripcion'].value
        //const descripcion=document.querySelector('#descripcionImput').value
        const id =formularioEdit.dataset.id
        //console.log(nombre,descripcion,id)
try {
    const data = await fetch(`/mascotas/${id}`,{
        method: 'put',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({nombre,descripcion})

    })
    const res = await data.json()
    if(res.estado){
        window.location.href='/mascotas'
    }else{
        console.log(error)
    }
} catch (error) {
    console.log(error)
}
    })
</script>